---
trigger: manual
---

Antigravity Code Generation Standards

This rule set defines the mandatory standards for all code generated by Antigravity. These rules are designed not just to pass ansible-test sanity, but to exceed the baseline requirements for robustness and maintainability.

1. Core Ansible Architecture (The "Validate-Modules" Standard)

Goal: Zero failures on validate-modules and ansible-doc.

Metadata Completeness:

DOCUMENTATION Block: Must be present in every module. Must include module, short_description, description, version_added, author, options (with type, description, required fields).

EXAMPLES Block: Must be valid YAML. Must include at least two distinct scenarios (e.g., "Create resource" and "Remove resource").

RETURN Block: Must verify every key returned by the module. Must include description, returned (e.g., always, success), and type.

No Standard Output: Code must never use print(). All output must be returned via module.exit_json() or module.fail_json().

Argument Specs: All input arguments must be defined in argument_spec with specific types (e.g., type='list', elements='str') rather than generic types.

2. Python Quality & Compatibility

Goal: Pass pep8, pylint, and compile checks across Python 3.6 through 3.12.

Strict PEP 8:

Indentation: Exactly 4 spaces (no tabs).

Line Length: Maximum 160 characters (relaxed from 79 for readability, but sanity often checks 160).

Spacing: Two blank lines before top-level class/function definitions.

Version Compatibility:

Do not use f-strings if targeting < Python 3.6 (unless future imports are handled).

Use ansible.module_utils.six for string/integer compatibility if needed.

Forbidden: basestring (Python 2 relic).

Error Handling:

Forbidden: assert statements (Security/Production risk).

Mandatory: Use try...except blocks for external API calls or file I/O. Catch specific exceptions, not bare except:.

3. Formatting & Syntax Integrity

Goal: Pass yamllint, no-smart-quotes, and line-endings.

Quote Discipline:

Strictly Forbidden: Smart quotes/Curly quotes (“, ”, ‘, ’).

Required: Standard ASCII straight quotes (" or ').

Line Endings:

Must use UNIX style (\n) only. Windows (\r\n) is forbidden.

File Headers:

Python files must start with:

#!/usr/bin/python
# -*- coding: utf-8 -*-


Copyright headers must be included if legally required by the project scope.

4. "Above Standard" Enhancements

Docstrings: Every internal function must have a Python docstring explaining its purpose, arguments, and return values (even if not exposed to Ansible).

Idempotency Check: Every main() function logic must explicitly calculate changed=True vs changed=False based on state comparison, not just API execution.

Cyclomatic Complexity: Keep functions small. If a main() function exceeds 50 lines, break logic into helper classes or functions.

5. Security & Best Practices

No Hardcoded Secrets: Never output passwords or keys in plain text in examples or debug logs. Use no_log=True for sensitive module parameters.

Unsafe Imports: Do not use from module import *. Explicitly import required classes/functions.